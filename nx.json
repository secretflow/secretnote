{
  // We are using Nx for monorepo task orchestration
  // See https://nx.dev/concepts/mental-model
  "$schema": "https://cdn.jsdelivr.net/npm/nx@latest/schemas/nx-schema.json",
  // Inputs affect when Nx will re-run a task
  // If inputs are not changed then Nx will skip re-run and replay cached results
  // For example, we would want to re-run ESLint whenever eslintrc is updated
  // This guarantees that tasks are always correct and up-to-date
  //
  // Named inputs defined here are to be referenced in targetDefaults
  // See https://nx.dev/concepts/mental-model#computation-hashing-and-caching
  // and https://nx.dev/reference/nx-json#inputs-&-namedinputs
  //
  // ${workspaceRoot} = root of repo
  // ${projectRoot} = root of package in which the task is defined
  "namedInputs": {
    ":default": ["{projectRoot}/**/*"],
    ":eslint": [
      "{workspaceRoot}/.eslintrc.{js,cjs}",
      "{workspaceRoot}/.eslintrc.*.{js,cjs}",
      "{workspaceRoot}/.eslintignore",
      "{workspaceRoot}/.remarkrc.mjs",
      "{projectRoot}/.eslintrc.{js,cjs}"
    ],
    ":stylelint": [
      "{workspaceRoot}/.stylelintrc.{js,cjs}",
      "{workspaceRoot}/.stylelintignore",
      "{projectRoot}/.stylelint.{js,cjs}"
    ],
    ":prettier": [
      "{workspaceRoot}/.prettierrc.json",
      "{workspaceRoot}/.prettierignore"
    ],
    ":tsc": [
      "{workspaceRoot}/tsconfig.json",
      "{workspaceRoot}/tsconfig.*.json",
      "{projectRoot}/**/tsconfig.json",
      "{projectRoot}/**/tsconfig.*.json"
    ],
    ":vitest": [
      "{workspaceRoot}/vitest.config.mts",
      "{workspaceRoot}/vitest.config.mjs"
    ],
    ":python": [
      "{workspaceRoot}/pyproject.toml",
      "{workspaceRoot}/.python-version",
      "{projectRoot}/**/*.{py,pyi}"
    ],
    ":ruff": ["{projectRoot}/ruff.toml"],
    ":umi": ["{projectRoot}/.umirc.ts"]
  },
  // targetDefaults configure default options for each task
  // such as inputs, outputs and dependencies
  // See https://nx.dev/reference/nx-json#target-defaults
  // The actual commands are defined in the `scripts` section in each package's package.json
  "targetDefaults": {
    "setup:umi": {
      "inputs": [":default", ":tsc", ":umi"],
      "outputs": ["{projectRoot}/src/.umi"]
    },
    "build:vite": {
      "inputs": [":default", ":tsc"],
      "outputs": ["{projectRoot}/dist", "{projectRoot}/build"],
      "dependsOn": ["^build:vite", "^build:tsup", "^build:hatch", "^build:umi"]
    },
    "build:umi": {
      "inputs": [":default", ":tsc", ":umi"],
      "outputs": ["{projectRoot}/dist"],
      "dependsOn": ["^build:vite", "^build:tsup", "^build:hatch", "^build:umi"]
    },
    "build:tsup": {
      "inputs": [":default", ":tsc"],
      "outputs": ["{projectRoot}/dist"],
      "dependsOn": ["^build:vite", "^build:tsup", "^build:hatch", "^build:umi"]
    },
    "build:hatch": {
      "inputs": [":default", ":python"],
      "outputs": ["{projectRoot}/dist"],
      "dependsOn": ["^build:vite", "^build:tsup", "^build:hatch", "^build:umi"]
    },
    "lint:eslint": {
      "inputs": [":default", ":eslint"]
    },
    "lint:stylelint": {
      "inputs": [":default", ":stylelint"]
    },
    "typecheck:tsc": {
      "inputs": [":default", ":tsc"]
    },
    "format:black": {
      "inputs": [":default", ":python"]
    },
    "lint:ruff": {
      "inputs": [":default", ":python", ":ruff"]
    },
    "typecheck:pyright": {
      "inputs": [":default", ":python"]
    },
    "test:vitest": {
      "inputs": [":default", ":vitest"],
      "outputs": ["{projectRoot}/coverage"]
    },
    "test:pytest": {
      "inputs": [":default", ":python"]
    },
    "publish:hatch": {
      "dependsOn": ["^build:vite", "^build:tsup", "^build:hatch", "^build:umi"]
    },
    "format:prettier": {},
    "ci:setup": {},
    "ci:javascript": {},
    "ci:python": {},
    "ci:publish": {}
  },
  "tasksRunnerOptions": {
    "default": {
      "runner": "nx/tasks-runners/default",
      "options": {
        "parallel": 8,
        "cacheableOperations": [
          // not cacheable due to unpredictable artifact outputs
          // "build:hatch",
          "build:tsup",
          "build:umi",
          "build:vite",
          "format:black",
          "format:prettier",
          "lint:eslint",
          "lint:ruff",
          "lint:stylelint",
          "setup:umi",
          "test:pytest",
          "test:vitest",
          "typecheck:pyright",
          "typecheck:tsc"
        ]
      }
    }
  }
}
